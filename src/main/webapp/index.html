<!DOCTYPE html>
<html lang="en">
<head>
<title>Janus</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap -->
<link href="static/css/bootstrap.min.css" rel="stylesheet"
	media="screen">
<link href="static/css/font-awesome.min.css" rel="stylesheet">

<!-- janus -->
<link href="static/css/janus.css" rel="stylesheet" media="screen">

<!-- templates -->
<script id="book-template" type="text/x-handlebars-template">
      {{! sample expanded book row template }}
      <div class="row entry">
        <div class="entryItem entryCellThumb">
          <img src="s/file/cover/{{id}}" class="thumbnail entryThumb"/>
        </div>
        <div class="entryItem entryCellMain">
          <h4><em>{{title}}</em></h3>
          <h5>{{subtitle}}</h4>
          {{#if series}}
          <h6>Book {{seriesIndex}} in <em>{{series_helper series}}</em></h5>
          {{/if}}
          {{#if fileInfo}}
            <select id="download_box_{{../id}}">
            {{#each fileInfo}}
              <option value="{{identifier}}">{{type}} ({{descriptiveSize}})</option>
            {{/each}}
            </select>
            <a class="btn" onclick="download('{{../id}}')"><i class="icon-download-alt"></i></a>
          {{/if}}
        </div>
        <div class="entryItem entryCellAdditionalAuthor">
          {{#if authors}}
            {{#each authors}} 
              <p>{{name}}</p>
            {{/each}}
          {{/if}}
        </div>
        <div class="entryItem entryCellDownload">
        </div>
      </div> <!-- /row -->      
    </script>
    
    <script id="author-template" type="text/x-handlebars-template">
      <div class="row entry">
        <div class="entryItem entryCellThumb">
          <img src="s/file/cover/1" class="thumbnail entryThumb"/>
        </div>
        <div class="entryItem entryCellMain">
          <h4><em>{{name}}</em></h3>
        </div>
      </div> <!-- /row -->      

	</script>
</head>
<body>

	<div id="mainBox" class="container">
		<em>http://localhost:8080/janus/s/</em><input id="go"></input><a class="btn" onclick="request()">go!</a>
	</div>
	<!-- /container -->

	<div id="mainBox" class="container"></div>
	<!-- /container -->

	<!-- scripts -->
	<script src="static/js/jquery.js"></script>
	<script src="static/js/bootstrap.min.js"></script>
	<script src="static/js/handlebars.js"></script>

	<!-- handlebars template stuff -->
	<script>
    	var book_source   = $("#book-template").html();
    	var book_template = Handlebars.compile(book_source);

		var author_source = $("#author-template").html();
    	var author_template = Handlebars.compile(author_source);
    	
        //register helpers
        Handlebars.registerHelper('series_helper', function(seriesList) {
          return new Handlebars.SafeString(
            seriesList[0].name
          );
        });

      function request() {
        var url = $('#go').val();
          
  		$.ajax("s/" + url).success(
			function(context) {
   				renderList(context);
			}
	    );    	
      }

	  function renderList(itemList) {
		// if item list isn't actually an item
		if(!itemList.length && itemList.type) {
			renderItem(itemList);
		}
				  
        for(var i = 0; i < itemList.length; i++) {
			var item = itemList[i];
			renderItem(item);
		}
	  }

	  function renderItem(item) {
        var html = false;
	  
        if("book" == item.type) {
           	html = book_template(item);
       	} else if("author") {
           	html = author_template(item);
           }

		if(html) {    			            
           	$('#mainBox').append(html);
		}
	  }

	  function download(id) {
		  var identifier = $('#download_box_' + id).val();
		  var url = "s/file/book/" + identifier;
		  $.get(url)
		  .success(
		    function() {
			  alert('got!');
			}
		  );
	  }
        
      $(document).ready(function() {
          
      });
    </script>
</body>
</html>